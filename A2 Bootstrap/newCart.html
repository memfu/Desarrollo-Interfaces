<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Callejón Diagón</title>
    <link rel="shortcut icon" href="https://mystickermania.com/cdn/stickers/harry-potter/harry-potter-flying-broom-512x512.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <style>
        #proporcion>div {
            text-align: center;
        }

        .card {
            height: 100%;
            /* Las tarjetas se adaptan al mismo alto */
        }

        .card img {
            height: 200px;
            /* Altura uniforme para las imágenes */
            object-fit: contain;
            /* Ajusta la imagen dentro del contenedor sin cortarla */
            width: 100%;
            /* Asegura que la imagen ocupa el ancho completo del contenedor */
        }

        .card-footer {
            margin-top: auto;
            /* Hace que la parte inferior esté alineada al final de la tarjeta */
        }

        .card-title {
            font-size: 1.2rem;
            /* Tamaño uniforme para los títulos */
        }
    </style>
</head>

<body
    background="https://static.vecteezy.com/system/resources/previews/002/202/062/non_2x/bardy-abstract-textured-grunge-web-background-vector.jpg">
    <div class="container">
        <div id="proporcion" class="alert alert-warning">
            <div center>
                <h3>CALLEJÓN DIAGÓN</h3>
            </div>
        </div>
    </div>
    <div class="container my-4">
        <div class="row">
            <!-- Sección de artículos -->
            <div class="col-lg-8">
                <div class="row g-3">
                    <!-- Fila 1 de artículos -->
                    <div class="col-md-4">
                        <div class="card">
                            <img src="https://www.emp.de/dw/image/v2/BBQV_PRD/on/demandware.static/-/Sites-master-emp/default/dwc4615a98/images/5/0/4/1/504194a.jpg?sw=1000&sh=800&sm=fit&sfrm=png"
                                class="d-block w-100" alt="Calcetines Harry Potter">
                            <div class="card-body">
                                <h5 class="card-title" id="producto1item" value="Calcetines Harry Potter">Calcetines
                                    Harry Potter</h5>
                            </div>
                            <form id="datosItem1" class="card-footer mt-auto">
                                <div class="mb-3 d-flex align-items-center">
                                    <p class="card-text" id="producto1precio">Precio: 13.99€</p>
                                </div>
                                <div class="mb-3 d-flex align-items-center">
                                    <label class="me-2" style="width: 80px;">Cantidad:</label>
                                    <div class="input-group" style="width: 150px;">
                                        <input type="number" id="producto1cantidad" name="cantidad" min="1" max="20"
                                            class="form-control" oninput="validarRango(this)">
                                    </div>
                                </div>

                                <button type="button" class="btn btn-primary" onclick="agregarArticulo(1)">Añadir al
                                    carrito</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <img src="https://www.emp.de/dw/image/v2/BBQV_PRD/on/demandware.static/-/Sites-master-emp/default/dw60bb4e61/images/4/9/2/3/492341.jpg?sw=1000&sh=800&sm=fit&sfrm=png"
                                class="d-block w-100" alt="Taza del Mapa del Merodeador">
                            <div class="card-body">
                                <h5 class="card-title" id="producto2item" value="Taza del Mapa del Merodeador">Taza del
                                    Mapa del Merodeador</h5>
                            </div>
                            <form id="datosItem2" class="card-footer mt-auto">
                                <div class="mb-3 d-flex align-items-center">
                                    <p class="card-text" id="producto2precio">Precio: 16.99€</p>
                                </div>
                                <div class="mb-3 d-flex align-items-center">
                                    <label class="me-2" style="width: 80px;">Cantidad:</label>
                                    <div class="input-group" style="width: 150px;">
                                        <input type="number" id="producto2cantidad" name="cantidad" min="1" max="20"
                                            class="form-control" oninput="validarRango(this)">
                                    </div>
                                </div>

                                <button type="button" class="btn btn-primary" onclick="agregarArticulo(2)">Añadir al
                                    carrito</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <img src="https://www.emp.de/dw/image/v2/BBQV_PRD/on/demandware.static/-/Sites-master-emp/default/dwf7b85bf4/images/5/5/3/6/553622a.jpg?sw=1000&sh=800&sm=fit&sfrm=png"
                                class="d-block w-100" alt="Calendario de Adviento">
                            <div class="card-body">
                                <h5 class="card-title" id="producto3item" value="Calendario de Adviento">Calendario de
                                    Adviento</h5>
                            </div>
                            <form id="datosItem3" class="card-footer mt-auto">
                                <div class="mb-3 d-flex align-items-center">
                                    <p class="card-text" id="producto3precio">Precio: 54.99€</p>
                                </div>
                                <div class="mb-3 d-flex align-items-center">
                                    <label class="me-2" style="width: 80px;">Cantidad:</label>
                                    <div class="input-group" style="width: 150px;">
                                        <input type="number" id="producto3cantidad" name="cantidad" min="1" max="20"
                                            class="form-control" oninput="validarRango(this)">
                                    </div>
                                </div>

                                <button type="button" class="btn btn-primary" onclick="agregarArticulo(3)">Añadir al
                                    carrito</button>
                            </form>
                        </div>
                    </div>
                    <!-- Fila 2 de artículos -->
                    <div class="col-md-4">
                        <div class="card">
                            <img src="https://www.emp.de/dw/image/v2/BBQV_PRD/on/demandware.static/-/Sites-master-emp/default/dwacb1ba60/images/4/8/4/7/484759a.jpg?sw=1000&sh=800&sm=fit&sfrm=png"
                                class="d-block w-100" alt="Set de vuelta al cole">
                            <div class="card-body">
                                <h5 class="card-title" id="producto4item" value="Set de vuelta al cole">Set de vuelta al
                                    cole</h5>
                            </div>
                            <form id="datosItem4" class="card-footer mt-auto">
                                <div class="mb-3 d-flex align-items-center">
                                    <p class="card-text" id="producto4precio">Precio: 61.99€</p>
                                </div>
                                <div class="mb-3 d-flex align-items-center">
                                    <label class="me-2" style="width: 80px;">Cantidad:</label>
                                    <div class="input-group" style="width: 150px;">
                                        <input type="number" id="producto4cantidad" name="cantidad" min="1" max="20"
                                            class="form-control" oninput="validarRango(this)">
                                    </div>
                                </div>

                                <button type="button" class="btn btn-primary" onclick="agregarArticulo(4)">Añadir al
                                    carrito</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <img src="https://www.emp.de/dw/image/v2/BBQV_PRD/on/demandware.static/-/Sites-master-emp/default/dw14236890/images/4/3/9/8/439831a2.jpg?sw=1000&sh=800&sm=fit&sfrm=png"
                                class="d-block w-100" alt="Giratiempos Hermione Granger">
                            <div class="card-body">
                                <h5 class="card-title" id="producto5item" value="Giratiempos">Giratiempos de Hermione
                                    Granger</h5>
                            </div>
                            <form id="datosItem5" class="card-footer mt-auto">
                                <div class="mb-3 d-flex align-items-center">
                                    <p class="card-text" id="producto5precio">Precio: 14.99€</p>
                                </div>
                                <div class="mb-3 d-flex align-items-center">
                                    <label class="me-2" style="width: 80px;">Cantidad:</label>
                                    <div class="input-group" style="width: 150px;">
                                        <input type="number" id="producto5cantidad" name="cantidad" min="1" max="20"
                                            class="form-control" oninput="validarRango(this)">
                                    </div>
                                </div>

                                <button type="button" class="btn btn-primary" onclick="agregarArticulo(5)">Añadir al
                                    carrito</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <img src="https://www.emp.de/dw/image/v2/BBQV_PRD/on/demandware.static/-/Sites-master-emp/default/dwe04498dd/images/3/4/1/1/341100a.jpg?sw=1000&sh=800&sm=fit&sfrm=png"
                                class="d-block w-100" alt="Felpudo Alohomora">
                            <div class="card-body">
                                <h5 class="card-title" id="producto6item" value="Felpudo Alohomora">Felpudo Alohomora
                                </h5>
                            </div>
                            <form id="datosItem6" class="card-footer mt-auto">
                                <div class="mb-3 d-flex align-items-center">
                                    <p class="card-text" id="producto6precio">Precio: 10.99€</p>
                                </div>
                                <div class="mb-3 d-flex align-items-center">
                                    <label class="me-2" style="width: 80px;">Cantidad:</label>
                                    <div class="input-group" style="width: 150px;">
                                        <input type="number" id="producto6cantidad" name="cantidad" min="1" max="20"
                                            class="form-control" oninput="validarRango(this)">
                                    </div>
                                </div>

                                <button type="button" class="btn btn-primary" onclick="agregarArticulo(6)">Añadir al
                                    carrito</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección del carrito -->
            <div class="col-lg-4">
                <div id="proporcion" class="alert alert-primary col-lg-12 col-md-6 text-center">
                    <h2>Carrito</h2>
                </div>
                <!-- Lista de artículos en el carrito -->
                <div class="col m-3 p-3" id="listaCarrito" style="background-color: beige;"></div>

                <ul id="listaCarrito" class="list-group mb-3"></ul>
                <div class="alert alert-primary col-lg-12 col-md-6 text-center">
                    <h4 id="totalCarrito">Total pedido: €0.00</h4>
                </div>

                <div class="container text-center">
                    <button type="button" class="btn btn-primary w-100 mb-2" onclick="comprar()" >COMPRAR AHORA</button>
                    <br>
                    <button type="button" class="btn btn-warning w-100" onclick="borrarUltimoArticulo()">ELIMINAR ÚLTIMO
                        PRODUCTO</button>
                </div>

            </div>
        </div>
    </div>
    </div>

    <script>
        const carritoArray = []; // Array de almacenamiento de elementos - Referencia de la variable no se cambia, pero los valores internos sí, por eso const
        

        function agregarArticulo(articuloNr) {
            // Recoge los datos del formulario
            // Si lo hubiera puesto como input con document.getElementById('X').value valdría, pero visualmente no me convencía
            const articulo = document.getElementById('producto' + articuloNr + 'item').textContent.trim();
            const precio = parseFloat(document.getElementById('producto' + articuloNr + 'precio')
                .textContent.replace('Precio: ', '').replace('€', '')); // Me quedo solo con el número y lo paso a float para poder calcular
            const cantidad = parseInt(document.getElementById('producto' + articuloNr + 'cantidad').value);


            if (cantidad > 0) {
                // Primero se verifica si el artículo ya está en el carrito
                const existingItem = carritoArray.find(item => item.articulo === articulo);

                if (existingItem) {
                    // Verifica si la cantidad total del artículo (actual + nueva) excede el límite de 20
                    if (existingItem.cantidad + cantidad > 20) {
                        alert('No puedes agregar más de 20 unidades de este artículo al carrito.');
                        return; // Sale de la función sin agregar más cantidad
                    }
                    // Si ya está en el carrito y no excede 20 unidades, le agrega la nueva cantidad
                    existingItem.cantidad += cantidad;
                } else {
                    // Si es nuevo en el carrito, genero el nuevo objeto que es un json para luego insertarlo en el array del carrito
                    const nuevoArticulo = {
                        id: articuloNr,
                        articulo: articulo,
                        precio: precio,
                        cantidad: cantidad
                    };

                    carritoArray.push(nuevoArticulo);
                    // Se podría hacer directamente usando carrito.push({articulo:articulo, precio: precio, cantidad: cantidad});
                }

                // Se limpia el input de cantidad del formulario una vez que clicamos "Añadir"
                document.getElementById('producto' + articuloNr + 'cantidad').value = '';

                mostrarArticulos();

            } else {
                alert('Por favor, ingresa una cantidad válida.');
            }
        };

        function mostrarArticulos() {
            const listaCarrito = document.getElementById('listaCarrito');
            listaCarrito.innerHTML = ''; // Limpia lo que tenga anteriormente

            carritoArray.forEach((item) => {

                // Creo un contenedor div para albergar las demás etiquetas donde interpolo los datos del bucle forEach
                const divmuestra = document.createElement("div")

                // Calculo el subtotal por artículo
                const subtotal = (item.precio * item.cantidad).toFixed(2); // Se redondea a 2 decimales

                divmuestra.innerHTML = `
                <div class="mb-4">
                    <p><b>${item.articulo}</b></p>
                    <div class="d-flex justify-content-end">
                        <p style="text-align: right;">${item.precio} euros - ${item.cantidad} unidad/es</p>
                    </div>
                    <div class="d-flex justify-content-end">
                        <p style="text-align: right; font-weight: bold;">Subtotal: ${subtotal} euros</p>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-danger me-2" onclick="borrarArticulo(${item.id}, 1)" type="button">Eliminar 1 unidad</button>
                        <button class="btn btn-danger" onclick="borrarArticulo(${item.id}, 10)" type="button">Eliminar todos</button> <br><br>
                    </div>
                </div>`;

                listaCarrito.appendChild(divmuestra);
            });

            const totalHtml = document.getElementById("totalCarrito");

            const total = carritoArray.reduce((acc, producto) => { // "reduce" recorre cada item en el array, calcula el subtotal de cada producto y lo va sumando en el acumulador (acc), que comienza en 0
                return acc + (producto.precio * producto.cantidad);
            }, 0);

            const totalRedondeado = parseFloat(total.toFixed(2)); // Redondea a 2 decimales

            totalHtml.innerHTML = 'Total pedido: ' + totalRedondeado + "€"

        };

        function borrarArticulo(id, cantidad) {
            const existingItem = carritoArray.findIndex(item => item.id === id);
            if (cantidad === 1) {
                if (existingItem !== -1) { // si no retorna -1, porque ha encontrado un índice para el artículo en la lista
                    carritoArray[existingItem].cantidad--;
                    if (carritoArray[existingItem].cantidad <= 0) // Si la cantidad es menor o igual a 0
                        carritoArray.splice(existingItem, 1) // Elimina el artículo por completo
                }
            } else {
                carritoArray.splice(existingItem, 1);
            }

            mostrarArticulos();
        };

        function borrarUltimoArticulo() {
            carritoArray.pop();
            mostrarArticulos();
        };

        function comprar() {
            const totalPrecio = carritoArray.reduce((acc, producto) => {
                return acc + (producto.precio * producto.cantidad);
            }, 0)

            const totalRedondeado = parseFloat(totalPrecio.toFixed(2)); // Redondea a 2 decimales

            const totalProductos = carritoArray.reduce((acc, producto) => {
                return acc + producto.cantidad;
            }, 0)


            alert("TU COMPRA ES DE: " + totalProductos + " productos con un importe total de " + totalRedondeado+"€")

        };

        function validarRango(cantidadInput) { // Para que el usuario no pueda introducir por teclado nrs. fuera del rango 1-20
            const min = parseInt(cantidadInput.min);
            const max = parseInt(cantidadInput.max);
            const value = parseInt(cantidadInput.value);

            // Si el valor está fuera del rango, corregirlo
            if (value < min) {
                input.value = min;
            } else if (value > max) {
                input.value = max;
            }
        };
    </script>
</body>

</html>